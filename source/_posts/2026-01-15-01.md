---
title: Linuxä¸‹éƒ¨ç½²Mihomo
date: 2025-12-31 00:29:14
cover: 
feature: false
tags:
  - è¿ç»´
categories:
  - è¿ç»´
---


## å¯åŠ¨å®¹å™¨

è¿è¡Œä¸‹é¢çš„è„šæœ¬å¯åŠ¨å®¹å™¨

```bash
#!/usr/bin/env bash

__main() {
  {
    # é•œåƒå‡†å¤‡
    _image1="ghcr.io/lwmacct/250210-cr-mihomo:v1.19.3-t2503220"
    _image2="$(docker images -q $_image1)"
    if [[ "$_image2" == "" ]]; then
      docker pull $_image1
      _image2="$(docker images -q $_image1)"
    fi
  }

  _apps_name="service-mihomo"
  _apps_data="/data/$_apps_name"
  cat <<EOF | docker compose -p "$_apps_name" -f - up -d --remove-orphans
services:
  main:
    container_name: $_apps_name
    image: "$_image2"
    restart: always
    privileged: true
    network_mode: host
    volumes:
      - $_apps_data:/apps/data
    environment:
      - TZ=Asia/Shanghai
EOF
}
__main
```

## ç¼–å†™é…ç½®

è¿›å…¥å®¹å™¨å†…éƒ¨,è®¿é—®`config.yaml`é…ç½®æ–‡ä»¶,æ ¹æ®ä¸‹é¢æä¾›çš„é…ç½®æŒ‰éœ€ä¿®æ”¹

æ³¨æ„,ä¸‹é¢çš„é…ç½®å¯ç”¨äº†`TUN`æ¨¡å¼,å¹¶ä¸”ä»…ä»£ç†`github`ç›¸å…³çš„åŸŸå,å¦‚æœä½ éœ€è¦ä»£ç†å…¶ä»–åŸŸå,è¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹è§„åˆ™ã€‚

```yaml
# åŸºç¡€é…ç½®
port: 7890
socks-port: 7891
mixed-port: 7892
allow-lan: true
mode: rule
log-level: info
external-controller: 0.0.0.0:9090
secret: "123456"

dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip  # å…³é”®ï¼šè®©ç³»ç»Ÿè®¤ä¸ºæ‰€æœ‰åŸŸåéƒ½åœ¨ä»£ç†èŒƒå›´å†…
  nameserver:
    - 119.29.29.29
    - 223.5.5.5


# å¯ç”¨ tun æ¨¡å¼
tun:
  enable: true
  stack: system # æˆ–è€… gvisor
  auto-route: true # è‡ªåŠ¨è®¾ç½®ç³»ç»Ÿè·¯ç”±è¡¨ï¼Œæ¥ç®¡å…¨å±€æµé‡
  auto-detect-interface: true # è‡ªåŠ¨æ£€æµ‹å‡ºå£ç½‘å¡

# èŠ‚ç‚¹ä¿¡æ¯
proxies:
  - name: "ç¾å›½US01èŠ‚ç‚¹"
    server: <ä½ çš„èŠ‚ç‚¹IP/åŸŸå>
    port: <ä½ çš„èŠ‚ç‚¹ç«¯å£>
    type: <ä½ çš„èŠ‚ç‚¹ç±»å‹>
    cipher: <ä½ çš„èŠ‚ç‚¹åŠ å¯†æ–¹å¼>
    password: "<ä½ çš„èŠ‚ç‚¹å¯†ç >"
    udp: true

# ç­–ç•¥ç»„
proxy-groups:
  - name: "ğŸš€ ä»£ç†é€‰æ‹©"
    type: select
    proxies:
      - "ç¾å›½US01èŠ‚ç‚¹"
      - DIRECT

# è§„åˆ™é…ç½® (Rule)
rules:
  # å¼ºåˆ¶ GitHub æµé‡èµ°ä»£ç†
  - DOMAIN-KEYWORD,github,ğŸš€ ä»£ç†é€‰æ‹©
  - DOMAIN-SUFFIX,github.com,ğŸš€ ä»£ç†é€‰æ‹©
  - DOMAIN-SUFFIX,githubassets.com,ğŸš€ ä»£ç†é€‰æ‹©
  - DOMAIN-SUFFIX,githubusercontent.com,ğŸš€ ä»£ç†é€‰æ‹©
  - DOMAIN-SUFFIX,gist.github.com,ğŸš€ ä»£ç†é€‰æ‹©
  
  # å›½å†…å¸¸è§æœåŠ¡ç›´è¿ (é˜²æ­¢æœ¬åœ°æœåŠ¡è¯¯èµ°ä»£ç†)
  - GEOIP,CN,DIRECT
  
  # æ¼ç½‘ä¹‹é±¼å…¨éƒ¨ç›´è¿
  - MATCH,DIRECT
```