{"title":"通过Let’s Encrypt申请SSL泛域名证书","uid":"8d7719b423036d3eee5f283084ac02fe","slug":"2025-08-16-01","date":"2025-08-16T10:14:52.000Z","updated":"2025-09-03T09:27:53.510Z","comments":true,"path":"api/articles/2025-08-16-01.json","keywords":null,"cover":[],"content":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>Let’s Encrypt 是一个免费的、自动化、开放的证书颁发机构，为网站提供 HTTPS 加密。它使用 ACME 协议来验证域名所有权，并颁发免费的 SSL&#x2F;TLS 证书。</p>\n<p>这里通过<code>ubuntu</code>环境来演示申请过程,其他环境类似。</p>\n<p>并且此文章出现的域名皆为<code>example.com</code>。</p>\n<h2 id=\"安装工具\"><a href=\"#安装工具\" class=\"headerlink\" title=\"安装工具\"></a>安装工具</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update</span><br><span class=\"line\">apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"申请证书\"><a href=\"#申请证书\" class=\"headerlink\" title=\"申请证书\"></a>申请证书</h2><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>需要注意,在申请之前,你的域名(如<code>example.com</code>)必须已解析到支持 <strong>80&#x2F;443</strong> 端口的设备上,并且运行 nginx 或者 http 服务去监听端口,否则申请无法进行。</p>\n</div>\n<p>比如我这里直接申请一个<code>*.example.com</code>泛域名的证书,然后参考下面的命令:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">certbot certonly \\</span><br><span class=\"line\">  --manual \\</span><br><span class=\"line\">  --preferred-challenges dns \\</span><br><span class=\"line\">  -d <span class=\"string\">&quot;*.example.com&quot;</span> -d example.com</span><br></pre></td></tr></table></figure>\n\n<p>执行后,如果顺利,他会给你提供一个 <code>TXT</code> 记录让你去做一下解析,比如你的域名是<code>example.com</code>,那么他应该会给你提供一个<code>_acme-challenge.example.com</code>让你去做解析, 相应的,解析值也会提供给你,比如<code>_UqBFNOgsaxR6TfP7x-mE0FRknUb9AcSplePkgK1n1A</code>。</p>\n<p>你必须在你的域名解析中添加这个<code>TXT</code>记录,比如你的域名是阿里云来买的,那你就去阿里云的控制台,找到你的域名,然后添加<code>TXT</code>记录。</p>\n<p>添加完成后,你可以使用命令<code>dig TXT _acme-challenge.example.com +short</code>来查看是否添加成功, 如果生效了,他应该会输出如下内容:</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_UqBFNOgsaxR6TfP7x-mE0FRknUb9AcSplePkgK1n1A</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/./images/essay/2025-08-16-01/001.png\"></p>\n<div class=\"custom-quote danger\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M19.76 5.23C15.84 5.23 12 2 12 2C12 2 8.15996 5.23 4.23996 5.23C4.23996 5.23 1.86996 16.99 12 22C22.13 16.99 19.76 5.23 19.76 5.23Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 16H12\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>这里额外再提一嘴,你申请时,出现了添加 <code>TXT</code> 记录的提示时,先去添加,加完了再回车下一步,一共需要添加两次,加完了用上面的<code>dig</code>命令验证一下是否生效了,如果生效了再回车继续,否则必定申请失败! ! ! 务必保证解析生效后再回车继续! ! !</p>\n<p>当然,据我实际测试,有时他会让你添加两个 <code>TXT</code> 记录,但有时只需加一次,还没搞懂是为什么,反正加就对了</p>\n</div>\n<ul>\n<li>接下来是命令的完整输出,可以参考一下长啥样,如果顺利,他会输出如下内容:</li>\n</ul>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@localhost:~# certbot certonly   --manual   --preferred-challenges dns   -d &quot;*.example.com&quot; -d example.com</span><br><span class=\"line\">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class=\"line\">Requesting a certificate for *.example.com and example.com</span><br><span class=\"line\"></span><br><span class=\"line\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class=\"line\">Please deploy a DNS TXT record under the name:</span><br><span class=\"line\"></span><br><span class=\"line\">_acme-challenge.example.com.</span><br><span class=\"line\"></span><br><span class=\"line\">with the following value:</span><br><span class=\"line\"></span><br><span class=\"line\">_UqBFNOgsaxR6TfP7x-mE0FRknUb9AcSplePkgK1n1A</span><br><span class=\"line\"></span><br><span class=\"line\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class=\"line\">Press Enter to Continue</span><br><span class=\"line\"></span><br><span class=\"line\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class=\"line\">Please deploy a DNS TXT record under the name:</span><br><span class=\"line\"></span><br><span class=\"line\">_acme-challenge.example.com.</span><br><span class=\"line\"></span><br><span class=\"line\">with the following value:</span><br><span class=\"line\"></span><br><span class=\"line\">Ac1evz91bSOAyGRXHzYWaBB94xj-pUgEo6SMEbeJWGY</span><br><span class=\"line\"></span><br><span class=\"line\">(This must be set up in addition to the previous challenges; do not remove,</span><br><span class=\"line\">replace, or undo the previous challenge tasks yet. Note that you might be</span><br><span class=\"line\">asked to create multiple distinct TXT records with the same name. This is</span><br><span class=\"line\">permitted by DNS standards.)</span><br><span class=\"line\"></span><br><span class=\"line\">Before continuing, verify the TXT record has been deployed. Depending on the DNS</span><br><span class=\"line\">provider, this may take some time, from a few seconds to multiple minutes. You can</span><br><span class=\"line\">check if it has finished deploying with aid of online tools, such as the Google</span><br><span class=\"line\">Admin Toolbox: https://toolbox.googleapps.com/apps/dig/#TXT/_acme-challenge.example.com.</span><br><span class=\"line\">Look for one or more bolded line(s) below the line &#x27;;ANSWER&#x27;. It should show the</span><br><span class=\"line\">value(s) you&#x27;ve just added.</span><br><span class=\"line\"></span><br><span class=\"line\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class=\"line\">Press Enter to Continue</span><br><span class=\"line\"></span><br><span class=\"line\">Successfully received certificate.</span><br><span class=\"line\">Certificate is saved at: /etc/letsencrypt/live/example.com/fullchain.pem</span><br><span class=\"line\">Key is saved at:         /etc/letsencrypt/live/example.com/privkey.pem</span><br><span class=\"line\">This certificate expires on 2025-11-14.</span><br><span class=\"line\">These files will be updated when the certificate renews.</span><br><span class=\"line\"></span><br><span class=\"line\">NEXT STEPS:</span><br><span class=\"line\">- This certificate will not be renewed automatically. Autorenewal of --manual certificates requires the use of an authentication hook script (--manual-auth-hook) but one was not provided. To renew this certificate, repeat this same certbot command before the certificate&#x27;s expiry date.</span><br><span class=\"line\"></span><br><span class=\"line\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class=\"line\">If you like Certbot, please consider supporting our work by:</span><br><span class=\"line\"> * Donating to ISRG / Let&#x27;s Encrypt:   https://letsencrypt.org/donate</span><br><span class=\"line\"> * Donating to EFF:                    https://eff.org/donate-le</span><br><span class=\"line\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></pre></td></tr></table></figure>\n\n<p>直到最后,他会输出<code>Successfully received certificate.</code>,表示证书申请成功。</p>\n<p>并且你的证书文件存放在<code>/etc/letsencrypt/live/example.com</code>目录下, 分别是:</p>\n<ul>\n<li><code>fullchain.pem</code> 证书文件</li>\n<li><code>privkey.pem</code> 私钥文件</li>\n</ul>\n<p>到这里证书申请流程就结束了,证书有效期为90天,到期后需要重新申请。</p>\n","feature":false,"text":"介绍Let’s Encrypt 是一个免费的、自动化、开放的证书颁发机构，为网站提供 HTTPS 加密。它使用 ACME 协议来验证域名所有权，并颁发免费的 S...","permalink":"/post/2025-08-16-01","photos":[],"count_time":{"symbolsCount":"3.9k","symbolsTime":"4 mins."},"categories":[{"name":"运维","slug":"运维","count":10,"path":"api/categories/运维.json"}],"tags":[{"name":"运维","slug":"运维","count":3,"path":"api/tags/运维.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">介绍</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E5%B7%A5%E5%85%B7\"><span class=\"toc-text\">安装工具</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%94%B3%E8%AF%B7%E8%AF%81%E4%B9%A6\"><span class=\"toc-text\">申请证书</span></a></li></ol>","author":{"name":"Reverse","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"每一次的突破，都是自我超越的见证。","socials":{"github":"https://github.com/hyhacct","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Gorm自动识别添加或更新记录","uid":"25294f8b7eb85e03a5a5598b5ec408ff","slug":"2025-08-22-01","date":"2025-08-22T13:00:07.000Z","updated":"2025-09-03T09:27:53.510Z","comments":true,"path":"api/articles/2025-08-22-01.json","keywords":null,"cover":null,"text":"介绍写业务时需要用到 gorm 然后有个需求是根据某个字段(主键)来判断记录是否已存在,如果不存在,则创建这条记录,如果存在则更新. 上代码 注意!!! 这里u...","permalink":"/post/2025-08-22-01","photos":[],"count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"categories":[{"name":"Go","slug":"Go","count":4,"path":"api/categories/Go.json"}],"tags":[{"name":"Go","slug":"Go","count":2,"path":"api/tags/Go.json"}],"author":{"name":"Reverse","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"每一次的突破，都是自我超越的见证。","socials":{"github":"https://github.com/hyhacct","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":false},"next_post":{"title":"部署夜莺监控","uid":"9fb5a13df7aebee902991d52a2edd9f7","slug":"2025-08-13-02","date":"2025-08-13T12:35:53.000Z","updated":"2025-09-03T09:27:53.510Z","comments":true,"path":"api/articles/2025-08-13-02.json","keywords":null,"cover":null,"text":"下载软件包GitHub 下载软件包,点这里跳转 我这里使用v8.2.2版本,下载n9e-v8.2.2-linux-amd64.tar.gz 1wget http...","permalink":"/post/2025-08-13-02","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"运维","slug":"运维","count":10,"path":"api/categories/运维.json"}],"tags":[{"name":"运维","slug":"运维","count":3,"path":"api/tags/运维.json"}],"author":{"name":"Reverse","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"每一次的突破，都是自我超越的见证。","socials":{"github":"https://github.com/hyhacct","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":false}}