{"title":"在Ubuntu下部署ikuai软路由","uid":"909dff6351843daec939baa1f9ed28aa","slug":"2025-07-18-14","date":"2025-07-18T17:25:49.000Z","updated":"2025-09-03T09:27:53.509Z","comments":true,"path":"api/articles/2025-07-18-14.json","keywords":null,"cover":"/images/cover/Ikuai_1.png","content":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>ikuai 提供的是一个系统镜像,所以需要用到 kvm 来运行他,这里记录一下我的部署过程</p>\n<h2 id=\"准备环境\"><a href=\"#准备环境\" class=\"headerlink\" title=\"准备环境\"></a>准备环境</h2><p>安装 kvm,这一步是必须的</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  apt update</span><br><span class=\"line\">  apt install -y qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virt-manager</span><br><span class=\"line\">  lsmod | grep kvm</span><br><span class=\"line\">  usermod -aG libvirt $(<span class=\"built_in\">whoami</span>)</span><br><span class=\"line\">  usermod -aG kvm $(<span class=\"built_in\">whoami</span>)</span><br><span class=\"line\">  newgrp libvirt</span><br><span class=\"line\">  systemctl <span class=\"built_in\">enable</span> libvirtd</span><br><span class=\"line\">  systemctl start libvirtd</span><br><span class=\"line\">  systemctl status libvirtd</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"宿主机配置网络\"><a href=\"#宿主机配置网络\" class=\"headerlink\" title=\"宿主机配置网络\"></a>宿主机配置网络</h2><p>宿主机至少需要有一个口可以用来上网,因为 ikuai 需要两个网口,一个 wan 一个 lan,wan 口用来上网,lan 口则可以作为内网网关.</p>\n<p>这里直接使用网桥来创建就行,写一个配置文件,将下面的配置写进去,其实这个是自己随便定的,你可以是 172 段的 IP,内网无所谓,随便定义,看自己喜欢.</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>地址: 192.168.9.250<br>掩码: 16<br>网关: 192.168.9.1</p></blockquote>\n<p>将下面的配置写入到<code>/etc/netplan/01-br-lan1.yaml</code>文件中</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">network:</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"attr\">renderer:</span> <span class=\"string\">networkd</span></span><br><span class=\"line\">  <span class=\"attr\">ethernets:</span></span><br><span class=\"line\">    <span class=\"attr\">eno1:</span> <span class=\"comment\"># 改为你宿主机的网口</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">bridges:</span></span><br><span class=\"line\">    <span class=\"attr\">br-en01:</span></span><br><span class=\"line\">      <span class=\"attr\">interfaces:</span> [<span class=\"string\">eno1</span>] <span class=\"comment\"># 改为你宿主机的网口</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">addresses:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">192.168</span><span class=\"number\">.9</span><span class=\"number\">.250</span><span class=\"string\">/16</span> <span class=\"comment\"># 随便分配个地址</span></span><br><span class=\"line\">      <span class=\"attr\">gateway4:</span> <span class=\"number\">192.168</span><span class=\"number\">.9</span><span class=\"number\">.1</span> <span class=\"comment\"># 指定网关</span></span><br><span class=\"line\">      <span class=\"attr\">nameservers:</span></span><br><span class=\"line\">        <span class=\"attr\">addresses:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"number\">223.5</span><span class=\"number\">.5</span><span class=\"number\">.5</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"number\">119.29</span><span class=\"number\">.29</span><span class=\"number\">.29</span></span><br></pre></td></tr></table></figure>\n\n<p>执行此命令让其生效</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netplan apply</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"下载-ikuai-镜像\"><a href=\"#下载-ikuai-镜像\" class=\"headerlink\" title=\"下载 ikuai 镜像\"></a>下载 ikuai 镜像</h2><p>到官网 <code>https://www.ikuai8.com/component/download</code> 按需选择镜像并且下载到你的宿主机.</p>\n<p>下载完成后准备启动 kvm 虚拟机就行了,我这里下载的是 <a href=\"https://patch.ikuai8.com/3.x/iso/iKuai8_x64_3.7.20_Build202506041743.iso\">iKuai8_x64_3.7.20_Build202506041743.iso</a>,你可以点击下载也行.</p>\n<p>或者通过命令下载到宿主机:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://patch.ikuai8.com/3.x/iso/iKuai8_x64_3.7.20_Build202506041743.iso -O ikuai8_x64.iso</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动-KVM-虚拟机\"><a href=\"#启动-KVM-虚拟机\" class=\"headerlink\" title=\"启动 KVM 虚拟机\"></a>启动 KVM 虚拟机</h2><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">特别注意</p>\n<ol>\n<li>如果你想直接运行这个脚本,你需要将 ikuai 镜像移动到<code>/opt/iso/ikuai-x86.iso</code>.</li>\n<li>设置创建磁盘的大小,这里默认是<code>100G</code>如果可以则不需要修改.</li>\n<li>设置内存和 CPU,根据你的实际情况来修改,如果足够懒,你也可以不修改直接运行 :)</li>\n<li>如果你的宿主机<code>不具备图形界面则需要启用VNC功能</code>,否则你没有办法连接到 ikuai <strong>即便你使用 virsh console 进去也没法操作</strong>, 这里默认端口设置为 <code>5900</code> 了</li>\n<li>将你宿主机的物理网卡和刚才创建的虚拟网桥共享给虚拟机,详情见<code>network</code>参数部分.</li>\n</ol>\n\n</div>\n<ul>\n<li>eno1 作为 ikuai 的 wan 口,用来上网.</li>\n<li>br-lan1 作为 ikuai 的 lan 口,用来作为网关.</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  _kvm_disk_path=<span class=\"string\">&quot;/opt/iso/ikuai-x86.qcow2&quot;</span></span><br><span class=\"line\">  _kvm_iso_path=<span class=\"string\">&quot;/opt/iso/ikuai-x86.iso&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">mkdir</span> -p <span class=\"string\">&quot;<span class=\"subst\">$(dirname <span class=\"string\">&quot;<span class=\"variable\">$_kvm_disk_path</span>&quot;</span>)</span>&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">mkdir</span> -p <span class=\"string\">&quot;<span class=\"subst\">$(dirname <span class=\"string\">&quot;<span class=\"variable\">$_kvm_iso_path</span>&quot;</span>)</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 创建磁盘</span></span><br><span class=\"line\">  qemu-img create -f qcow2 <span class=\"string\">&quot;<span class=\"variable\">$_kvm_disk_path</span>&quot;</span> 100G</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 安装虚拟机(4G内存, 10G磁盘, 4核CPU)，图形界面 + 桥接网络</span></span><br><span class=\"line\">  virt-install \\</span><br><span class=\"line\">    --name ikuai \\</span><br><span class=\"line\">    --ram 4096 \\</span><br><span class=\"line\">    --vcpus 4 \\</span><br><span class=\"line\">    --os-type linux \\</span><br><span class=\"line\">    --hvm \\</span><br><span class=\"line\">    --virt-type kvm \\</span><br><span class=\"line\">    --cdrom <span class=\"string\">&quot;<span class=\"variable\">$_kvm_iso_path</span>&quot;</span> \\</span><br><span class=\"line\">    --disk path=<span class=\"string\">&quot;<span class=\"variable\">$_kvm_disk_path</span>&quot;</span>,format=qcow2,bus=virtio \\</span><br><span class=\"line\">    --network bridge=eno1,model=virtio \\</span><br><span class=\"line\">    --network bridge=br-lan1,model=virtio \\</span><br><span class=\"line\">    --graphics vnc,listen=0.0.0.0,port=5900 \\</span><br><span class=\"line\">    --noautoconsole \\</span><br><span class=\"line\">    --osinfo detect=on,name=linux2020</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>当你执行下面的脚本后,流程差不多就结束了,剩下的工作就很简单了,你只需要:</p>\n<ol>\n<li>等待系统安装完成,安装完成后虚拟机会重启,重启后手动<code>virsh start ikuai</code>启动虚拟机就行,如果看不到虚拟机则执行<code>virsh list --all</code>.</li>\n<li>打开 VNC 工具连接到你的 ikuai 虚拟机,手动配置一下网口就行 (很简单,图形化操作)</li>\n<li>注意 lan 口对应的是你宿主机的<code>br-lan1</code>,因此你在 ikuai 配置 lan 口时的地址和掩码以及网关都需要注意一下</li>\n</ol>\n","text":"概述ikuai 提供的是一个系统镜像,所以需要用到 kvm 来运行他,这里记录一下我的部署过程 准备环境安装 kvm,这一步是必须的 1234567891011...","permalink":"/post/2025-07-18-14","photos":[],"count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"categories":[{"name":"运维","slug":"运维","count":10,"path":"api/categories/运维.json"}],"tags":[{"name":"ikuai Ubuntu 软路由","slug":"ikuai-Ubuntu-软路由","count":1,"path":"api/tags/ikuai-Ubuntu-软路由.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">概述</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">准备环境</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%BF%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C\"><span class=\"toc-text\">宿主机配置网络</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%8B%E8%BD%BD-ikuai-%E9%95%9C%E5%83%8F\"><span class=\"toc-text\">下载 ikuai 镜像</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8-KVM-%E8%99%9A%E6%8B%9F%E6%9C%BA\"><span class=\"toc-text\">启动 KVM 虚拟机</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%80%E5%90%8E\"><span class=\"toc-text\">最后</span></a></li></ol>","author":{"name":"Reverse","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"每一次的突破，都是自我超越的见证。","socials":{"github":"https://github.com/hyhacct","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"在Ubuntu下安装sysbox","uid":"801add81576d2589d371217217c13cbc","slug":"2025-07-18-15","date":"2025-07-18T17:54:02.000Z","updated":"2025-09-03T09:27:53.509Z","comments":true,"path":"api/articles/2025-07-18-15.json","keywords":null,"cover":null,"text":"旧版本应该存在一些问题,某些场景下 docker 的功能不兼容或者不可用,在 dind 中更明显,所以直接安装最高版本. 1234567# 这里需要把容器先全部...","permalink":"/post/2025-07-18-15","photos":[],"count_time":{"symbolsCount":327,"symbolsTime":"1 mins."},"categories":[{"name":"运维","slug":"运维","count":10,"path":"api/categories/运维.json"}],"tags":[{"name":"sysbox","slug":"sysbox","count":1,"path":"api/tags/sysbox.json"}],"author":{"name":"Reverse","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"每一次的突破，都是自我超越的见证。","socials":{"github":"https://github.com/hyhacct","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"使用Vue实现瀑布流布局","uid":"2a7ed2ed5e24b574ac1497b2e3f1a5af","slug":"2025-07-18-13","date":"2025-07-18T15:06:23.000Z","updated":"2025-09-03T09:27:53.509Z","comments":true,"path":"api/articles/2025-07-18-13.json","keywords":null,"cover":null,"text":"概述瀑布流布局相比栅格网格不同的就是，只要卡片塞的合理，一般是不会出现空格。 不像栅格，只能做水平对齐，但是如果卡片的高度不能统一，那就会出现很多空白的区域，影...","permalink":"/post/2025-07-18-13","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"Vue.js","slug":"Vue-js","count":6,"path":"api/categories/Vue-js.json"}],"tags":[{"name":"Vue.js","slug":"Vue-js","count":3,"path":"api/tags/Vue-js.json"}],"author":{"name":"Reverse","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"每一次的突破，都是自我超越的见证。","socials":{"github":"https://github.com/hyhacct","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}