name: Deploy Hexo Blog

# 监听 main 分支推送，有推送则触发构建，使用 main 分支源码构建
on:
  push:
    branches: [ "main" ]

# 添加权限声明，确保可以推送到分支
permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: main
          submodules: false

      - name: Use Node.js 20.x
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: 'yarn'

      - name: Install Dependencies
        run: yarn install --frozen-lockfile

      - name: Build Hexo
        run: |
          ./node_modules/.bin/hexo clean
          ./node_modules/.bin/hexo generate

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }} # 使用内置 Token 即可
          publish_dir: ./public 
          publish_branch: gh-pages # 建议保持这个，然后在 GitHub 设置里指定 Pages 路径